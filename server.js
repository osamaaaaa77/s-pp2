const express = require("express");
const app = express();
const http = require("http").Server(app);
const io = require("socket.io")(http);

const adminIPs = [];

const words = ["Ù…ÙƒÙŠØ§Ø¬", "Ø§Ø³Ù†Ø§Ù†", "Ø²ÙŠØªÙˆÙ†", "Ø«ÙˆØ±", "ÙƒØ§Ù…ÙŠØ±Ø§", "Ø´ÙˆÙƒÙˆÙ„Ø§ØªÙ‡", "Ø¨Ø·Ø§Ø±ÙŠØ©", "Ø·Ø§ÙˆÙ„Ø©",
"Ø²ÙˆÙ…Ø¨ÙŠ", "Ø§Ù†Ù", "Ø´Ù†Ø¨", "Ù…Ù…Ø±Ø¶Ø©", "Ø¨ÙŠØª", "Ø°Ù‡Ø¨", "Ø¨Ø±ÙˆÙƒÙ„ÙŠ", "Ø¯ÙŠÙ†Ø§ØµÙˆØ±", "Ø§Ø³Ø¯",
"Ø·Ø§Ø¦Ø±Ø©", "Ø¶ÙØ¯Ø¹", "Ø²ÙŠØ§Ø¯", "ØªØ§Ø¬", "Ø³Ù†Ø¬Ø§Ø¨", "Ø¯Ø¬Ø§Ø¬", "Ø·Ø±ÙŠÙ‚", "ÙƒÙˆØ§Ù„Ø§", "ÙØ±Ø§Ø´Ø©",
"ÙŠØ¶Ø­Ùƒ", "ØªØ¨ÙˆÙ„Ø©", "Ø³Ø­Ù„ÙŠØ©", "Ø´Ø§Ù…Ø¨Ùˆ", "Ù…Ø­ÙØ¸Ø©", "Ù†Ø¬ÙˆÙ…", "Ø¨Ø§Øµ", "ØµÙŠØ¯Ù„ÙŠ", "Ù…Ø®Ø¯Ø©",
"Ø´Ø§Ø±Ø¹", "Ø²ÙŠØª", "Ø¬Ø§ÙƒÙŠØª", "Ø§Ø®Ø·Ø¨ÙˆØ·", "Ø§Ø¨Ø±Ø©", "Ù‚Ø§Ø±ÙˆØ±Ø©", "ÙÙ‡Ø¯", "Ø°Ø¦Ø¨", "Ø­Ù„Ø§ÙˆØ©",
"Ù…ØµØ§ØµØ©", "ÙƒØªØ§Ø¨", "Ø²Ù‡Ø±Ø©", "Ø¨Ø·Ø±ÙŠÙ‚", "Ù…Ø¹Ø¯Ø©", "Ø±Ù‚Øµ", "ÙƒØ±Ø© Ù‚Ø¯Ù…", "Ø®ÙØ§Ø´", "Ø¯ÙØªØ±",
"ÙØ·ÙŠØ±Ø©", "Ù…Ø³Ø±Ø­", "ØºÙŠÙˆÙ…", "Ù‚Ù…Ø±", "ØµØ­Ù†", "ÙˆØ±Ù‚ Ø¹Ù†Ø¨", "ÙˆØ±Ø¯Ø©", "ÙƒØ£Ø³", "ÙØ±Ø³ Ø§Ù„Ù†Ù‡Ø±",
"Ù†Ø³Ø±", "Ø«ÙˆØ¨", "Ø¹Ø³Ù„", "Ø¬Ù…Ù„", "Ù…Ø³Ù…Ø§Ø±", "Ù…Ø¯ÙŠÙ†Ø©", "Ø¯Ø¨Ø§Ø¨", "Ù…Ø³Ø·Ø±Ø©", "Ø·Ø§ÙˆÙˆØ³",
"Ø®Ø³", "ÙƒÙˆØ®", "Ù…Ø§ÙŠÙƒ", "Ø·Ø¨Ø§Ø®", "Ø§ÙÙˆÙƒØ§Ø¯Ùˆ", "Ø¯Ø±Ø¹", "Ù‚Ù†Ø¨Ù„Ø©",  "Ø±Ù…Ø­", "Ù…Ø±Ø¢Ø©",
"Ù…Ù„Ùƒ", "Ø­Ù…Ø§Ù…", "ÙØ³ØªØ§Ù†", "Ø¬Ø¨Ù†", "Ù…Ø­Ø§Ø³Ø¨", "Ù…Ø¯Ø±Ø³Ø©", "Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©", "Ù…ÙƒÙ†Ø³Ø©",
"ÙƒÙŠØ³", "ØªÙˆØµÙŠÙ„Ø©", "Ø´Ø±Ø§Ø¨",  "Ø¨Ø·Ø©", "Ø¬Ø¯Ø§Ø±", "Ø´Ù…Ø§Øº", "ÙƒØ±ÙŠØ¨", "Ù„Ø§Ø¨ØªÙˆØ¨",
"Ù…Ù„ÙˆØ®ÙŠØ©", "ÙƒØ±Ø²", "Ø¹Ø´Ø¨", "Ø¨Ø·ÙŠØ®", "ØªÙ„ÙØ§Ø²", "Ø·ÙŠØ§Ø±", "Ø±Ø³Ø§Ù…", "Ù‚Ù‡ÙˆØ©",
"Ø¬Ø²ÙŠØ±Ø©", "ØµØ§Ø¨ÙˆÙ†", "Ø³Ø§Ø¹Ø© ÙŠØ¯", "ÙƒØ±Ø³ÙŠ", "Ø¬Ø¨Ù„", "Ø¹ØµÙÙˆØ±", "Ø«Ø¹Ø¨Ø§Ù†", "Ù…Ù„ÙÙˆÙ",
"ÙƒØ±Ø© Ø³Ù„Ø©", "Ø¨Ø±ÙŠØ§Ù†ÙŠ", "Ù‚Ù„Ø¹Ø©", "ÙƒØ¨Ø©", "ÙƒÙˆÙƒØ¨", "Ø­Ø²ÙŠÙ†", "Ø³Ø¨Ø§Ù†Ø®", "Ø³ÙˆØ´ÙŠ", "Ù‡Ø§ØªÙ",
"Ø³Ø§Ø¹Ø©", "ÙˆØ±Ù‚Ø©", "Ø¹ÙŠÙ†", "Ø¨ÙˆÙ…Ø©", "Ù„Ø§Ù…Ø§", "Ù…Ø§Ø¡", "Ø®Ø±ÙŠØ·Ø©", "Ù†Ø¸Ø§Ø±Ø©", "Ø¹Ù„Ø¨Ø©", "Ø´Ø¨Ø­",
"ÙƒÙ†Ø§ÙØ©", "Ø³Ù…Ø¨ÙˆØ³Ø©", "Ø³Ù…ÙƒØ©", "Ø¯Ù…ÙŠØ©", "Ù‚ÙÙ„", "Ø§Ø¹ØµØ§Ø±", "ÙŠØ¨ÙƒÙŠ", "Ø¨Ø·Ø§Ø·Ø³", "ØµÙ„Ø¹Ù‡",
"Ø§Ø°Ù†", "Ù†Ø§ÙØ°Ø©", "Ù…Ù…Ø«Ù„", "ÙÙŠÙ„", "Ø±ÙŠÙ…ÙˆØª", "Ø´Ø§Ø·Ø¦", "ÙÙŠØ´", "Ø­Ø¨Ù„", "Ø­Ø§Ù…Ù„", "Ø³Ù…Ø§Ø¡",
"Ø³Ø¬Ø§Ø¯Ø©", "Ø³Ù„Ù…",  "Ù…Ù†Ø¯ÙŠ", "Ø°Ø±Ø©", "Ù†Ø¹Ø§Ù…Ø©", "Ø¹ØµØ§", "Ø®Ø¨Ø²", "ÙƒØ¨ ÙƒÙŠÙƒ",
"Ø·ÙÙ„", "Ù‚Ø§Ø¶ÙŠ", "Ø³ÙŠØ§Ø±Ø©", "Ø¨ÙŠØªØ²Ø§", "Ø¨ÙŠØ¶", "Ù…Ù‚Ù„ÙˆØ¨Ø©", "Ø¹Ø§Ø¦Ù„Ø©",  "ÙŠØ¯", "Ø¨Ø§Ø¦Ø¹",
"Ø¯ÙŠÙƒ", "Ø¸ÙØ±", "Ø´Ø±ÙŠØ·", "Ø´Ø§ÙŠ", "Ø­ØµØ§Ù†", "Ø³ØªØ§Ø±Ø©", "Ù…Ø±ÙˆØ­Ø©", "Ø³ÙƒÙŠÙ†", "Ù†Ø¬Ø§Ø±",
"Ù…Ø¬Ø±Ø©", "ÙÙ…", "Ø¯Ø¨ Ù‚Ø·Ø¨ÙŠ", "ÙˆØ­ÙŠØ¯ Ø§Ù„Ù‚Ø±Ù†", "Ø­Ù„ÙŠØ¨", "Ø³Ù…Ø§Ø¹Ø©", "Ø±Ø²",
"Ø´ØªØ§Ø¡", "Ù…Ø±Ø­Ø§Ø¶", "Ø³Ù„Ø©", "Ø³Ù„Ø·Ø©", "Ù‡Ø±Ù…", "Ù„Ø³Ø§Ù†", "ÙŠÙ…Ø´ÙŠ", "Ù‚Ù†Ø¯ÙŠÙ„", "Ø®Ù„Ø§Ø·", "Ù…ÙƒØ±ÙˆÙ†Ø©",
"ÙØ±Ø´Ø§Ø©", "Ø³Ù„Ùƒ", "Ø¹Ø·Ø±", "ÙƒØ±Ø©", "Ø¨Ø±Ø¬ Ø§ÙŠÙÙ„", "Ù‚Ø±Ø¯", "Ù‚Ù„Ù… Ø±ØµØ§Øµ", "Ù‡ÙŠÙƒÙ„ Ø¹Ø¸Ù…ÙŠ", "ÙØ·Ø±",
"ØºØ±Ø§Ø¨", "ÙÙ„Ø§Ø´Ø©", "Ø­ÙØ±Ø©", "Ù…Ø§Ù†Ø¬Ùˆ", "Ø³Ø§Ø¹Ø© Ø±Ù…Ù„ÙŠØ©", "Ù‚Ø¨Ø¹Ø©", "Ø§Ø·ÙØ§Ø¦ÙŠ", "Ø§Ù„Ù…Ø§Ø³",
"Ø«Ø¹Ù„Ø¨", "Ø®Ø±ÙˆÙ", "Ø³ØªÙŠÙƒ", "Ù…Ø·Ø±Ù‚Ø©", "Ø§Ø±Ù†Ø¨", "ÙƒØ¨Ø³Ø©", "Ø³Ø¬Ø§Ø¯Ù‡", "ÙØ§Ù†ÙˆØ³", "ÙƒÙŠØ¨ÙˆØ±Ø¯",
"ÙƒÙ†Ø²", "ÙŠØ±ÙƒØ¶", "Ù…ÙˆÙŠØ©", "Ù…Ù„Ø­", "Ù‚Ù„Ø¨", "Ø¬Ø±Ø³", "Ø®ÙŠØ§Ø·", "Ø¨ÙŠØ§Ù†Ùˆ", "Ø´Ù…Ø¹Ø©", "Ø³Ù„Ø·Ø¹ÙˆÙ†",
"Ù…Ø³Ø¯Ø³", "Ø§ØµØ¨Ø¹", "Ø­Ù…Ø§Ø±", "ÙƒØ´Ø±ÙŠ", "Ø²Ø¨Ø§Ù„Ø©", "Ø¨Ø§Ø°Ù†Ø¬Ø§Ù†", "Ø±Ù…Ø§Ù†", "Ø¬ÙˆØ² Ø§Ù„Ù‡Ù†Ø¯", "Ø´Ø§Ø­Ù†Ø©",
"Ù„Ø­Ù…", "Ù…Ø°ÙŠØ¹", "ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ", "ÙƒØ¨Ø§Ø¨", "ÙƒÙ…Ø¨ÙŠÙˆØªØ±", "Ø±Ù…ÙˆØ´", "Ø³Ø±ÙˆØ§Ù„", "Ù…Ø³ØªØ´ÙÙ‰", "ÙˆØ³Ø§Ø¯Ø©",
"ØµØ±ØµÙˆØ±", "Ø¹Ù„Ù…", "ØµØ§Ø±ÙˆØ®", "ÙÙˆÙ„", "Ø¹Ø¸Ù…", "Ø§Ù„Ø§Ø±Ø¶", "Ø³Ø¬Ù‚", "Ø¨Ø§Ø¨", "ÙƒÙ†Ø¨Ø©", "Ø­Ø¯ÙŠÙ‚Ø©",
"Ø¨ØµÙ„", "ÙØ£Ø±", "Ù…Ø¸Ù„Ø©", "Ù‚ÙˆØ³ Ù‚Ø²Ø­", "Ø®ÙŠÙ…Ø©", "Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ", "Ù…ØºÙ†ÙŠ", "Ø¬ÙˆØ§ÙØ©", "Ø­Ù„Ø²ÙˆÙ†",
"Ù‚Ø¯Ù…", "Ù†Ù‡Ø±", "ÙØ´Ø§Ø±", "Ù…Ø²Ø±Ø¹Ø©", "Ø­ÙˆØª", "Ø³ÙŠÙ", "Ø·Ø§Ø¨Ø¹Ø©", "ØºØ²Ø§Ù„", "Ù‡Ø¯ÙŠØ©", "Ù…Ù‡Ù†Ø¯Ø³",
"Ø¨Ø·Ø§Ø·Ø§", "Ø²Ø±Ø§ÙØ©", "Ø¯ÙˆÙ†Ø§Øª", "Ø§Ù„ÙƒØ¹Ø¨Ø©", "ÙØ±Ù†", "Ø¬Ø§Ù…Ø¹Ø©", "Ù…ÙƒÙŠÙ", "Ù…Ø§Ø¹Ø²", 
"Ù…ÙƒØªØ¨", "Ù…Ù†Ø´Ø§Ø±", "Ù…Ø§ÙˆØ³", "Ø¯ÙƒØªÙˆØ±", "Ø³Ø¨ÙˆØ±Ø©", "Ù…ÙƒØªØ¨Ø©", "ÙØ£Ø³", "Ø¬ÙˆØ§Ù„", "Ù‚Ø·Ø§ÙŠÙ",
"Ø®ÙˆØ®", "Ø¨Ø³ÙƒÙˆØª", "Ø­Ø¬Ø±", "Ø®Ø´Ø¨", "Ù…Ø¹Ù„Ù…", "Ù…Ø·Ø¨Ø®", "Ø¬Ø§Ù„Ø³", "Ø¨Ø·Ù†", "Ù‚ÙˆØ³", "Ø§ÙŠØ³ ÙƒØ±ÙŠÙ…",
"Ù‚Ø±Ø´", "Ø·Ø§ÙˆÙ„Ù‡", "ØºØ±ÙØ©", "Ø­Ø§Ø¬Ø¨", "Ø¹Ù†Ø¨", "Ø¬ÙˆØ§Ø±Ø¨", "Ø¨Ø±Ø¬ Ø®Ù„ÙŠÙØ©", "Ù…ÙˆØ²",
"Ø¯ÙˆÙ„Ø§Ø¨", "Ø±ÙˆØ¨ÙˆØª", "Ø³Ø±ÙŠØ±", "Ù…Ø³Ø¨Ø­", "Ù†Ø¹Ø§Ù„", "Ø´Ø§Ø´Ø©", "ÙˆØ­Ø´", "ÙÙ‚Ù…Ø©", "Ù…Ù„Ø¹Ø¨", "Ø³ÙŠÙ†Ù…Ø§",
"Ø­Ù…Øµ", "Ø¬Ø§Ù…ÙˆØ³", "ÙˆÙ„Ø§Ø¹Ø©", "ØµÙ‚Ø±", "Ø¬Ø²Ø±", "Ù‚Ø¯Ø±", "Ø³ÙÙŠÙ†Ø©", "Ù‡Ø¯Ù‡Ø¯", "ØªÙ†ÙŠÙ†", "Ù†Ù‚Ø§Ù†Ù‚",
"Ù†Ø§Ø±", "Ù…Ø´Ø·", "Ø¹ØµÙŠØ±", "Ù‚Ù…ÙŠØµ", "ÙÙ„ÙˆØ³", "Ù„ÙŠÙ„", "Ø¨Ø§Ù…ÙŠØ©", "Ø´ÙˆØ±Ø¨Ø©", "ÙØ±Ø´Ø©", "Ø®ÙŠØ§Ø±",
"ÙƒÙŠÙ„ØªØ§", "Ø·Ø¨Ù„", "Ù†Ø®Ù„Ø©", "Ø¯ÙˆØ¯Ø©", "Ø¨Ø±Ù‚", "Ø«Ù„Ø¬", "Ø­Ù„Ø§Ù‚", "Ø¨Ø±Ø¬Ø±", "Ù…Ø²Ù‡Ø±ÙŠØ©", "Ø¨Ø¨ØºØ§Ø¡",
"Ø¨Ø§Ù†Ø¯Ø§", "ÙŠØ³Ø¨Ø­", "Ù…Ù„Ø¹Ù‚Ø©", "Ù…Ø·Ø¹Ù…", "Ø²Ø±", "ÙƒÙ†ØºØ±", "ØªÙØ§Ø­", "Ø¨Ù‚Ù„Ø§ÙˆØ©", "ÙƒÙˆØ¨", "Ø²ÙŠØ²Ùˆ",
"Ø«Ù„Ø§Ø¬Ø©", "ÙØ±Ø§ÙˆÙ„Ø©", "ØºÙˆØ±ÙŠÙ„Ø§", "ØªÙ…Ø±", "Ø­Ø°Ø§Ø¡", "ØªÙ…Ø³Ø§Ø­", "Ù†Ù…Ø±", "ÙƒØ§ØªØ´Ø¨", "Ù…Ù†Ø³Ù",
"ØµÙ†Ø¯ÙˆÙ‚", "Ø¨Ø±ØªÙ‚Ø§Ù„", "Ù…ÙƒØ©", "Ø´Ø±Ø·ÙŠ", "Ø´Ø¬Ø±Ø©", "Ø¹Ø¯Ø³", "Ø¬Ù…Ø¬Ù…Ø©", "ØºØ³Ø§Ù„Ø©", "ÙÙ„ÙÙ„",
"Ø§Ø´Ø§Ø±Ø© Ù…Ø±ÙˆØ±", "ØºØ§Ø¨Ø©", "Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ", "Ø±ÙˆØ¨ÙŠØ§Ù†", "Ø³Ø§Ø¦Ù‚", "Ø¹Ù‚Ø±Ø¨", "Ù‚Ù„Ù…", "Ù…Ø­Ø§Ù…ÙŠ",
"Ø§Ù†Ø§Ù†Ø§Ø³", "Ø´ÙˆÙƒØ©", "Ø¨Ø­Ø±", "Ø·Ù…Ø§Ø·Ù…", "ÙƒÙŠÙƒ", "Ù‚Ù†ÙØ°", "Ø¯Ù…", "Ù‚Ø§Ø±Ø¨", "ØµØ¨Ø§Ø±", "Ø¨Ù‚Ø±Ø©",
"Ø´Ø·Ø±Ù†Ø¬", "Ù„Ø§Ø¹Ø¨", "Ø´Ù„Ø§Ù„", "Ø®Ù†Ø²ÙŠØ±", "Ø¨Ø±Ø¬", "Ø­Ù…Ø§Ø± ÙˆØ­Ø´ÙŠ", "Ø¯Ø¨Ø§Ø¨Ø©", "Ø¹Ù…Ø§Ø±Ø©", "Ø¯Ø¨Ø§Ø³Ø©",
"Ù†ÙˆÙ…", "Ù†Ù…Ù„", "Ù…ØµÙˆØ±", "ØµØ­Ø±Ø§Ø¡", "Ø°Ø¨Ø§Ø¨Ø©", "Ø«ÙˆÙ…", "Ø´Ù…Ø§Ù…", "Ù†Ø­Ù„Ø©", "Ù…Ù†Ø¯ÙŠÙ„",
"Ù‚Ø·Ø©", "Ù…Ø³Ø¬Ø¯", "Ù…ÙØªØ§Ø­", "Ø¯Ø±Ø§Ø¬Ø©", "ÙƒÙ†Ø¨", "Ù…Ø·Ø±", "Ù‚Ø·Ø§Ø±", "Ù†ÙˆØ±", "Ø³Ù„Ø­ÙØ§Ø©",
"Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ", "Ù…Ù‚Øµ", "Ø­Ù‚ÙŠØ¨Ø©", "Ø´Ù†Ø·Ø©", "Ù‡ØªØ§Ù†", "Ø¶Ø¨Ø¹", "ÙƒÙ„Ø¨", "Ø´Ø§ÙˆØ±Ù…Ø§", "Ø®Ø§ØªÙ…",
"Ù…ØµØ¨Ø§Ø­", "Ø¯ÙˆÙ„ÙÙŠÙ†", "Ø§ÙØ¹Ù‰", "Ø³ÙƒØ±", "Ø¨Ø±ÙƒØ§Ù†", "ØºÙˆØ§ØµØ©", "Ø¯Ø¨" ];

let currentWord = "";
let roundActive = false;

app.use(express.static("public"));

io.on("connection", (socket) => {
  const clientIP = socket.handshake.address;
  const isObserver = socket.handshake.headers.referer?.includes("observer=");
  socket.data.observer = isObserver;
  socket.data.isAdmin = adminIPs.includes(clientIP);

  if (!isObserver) {
    socket.data.points = 0;
    const defaultName = generateUniqueName();
    socket.data.name = defaultName;
    socket.emit("set name", defaultName);

    io.emit("system message", {
      msg: `${socket.data.name} Ø¯Ø®Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø©`,
      color: "blue"
    });
  }

  // âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†Ù‚
  socket.on("ping-check", (cb) => cb());

  // âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ù†Ù‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙƒÙ†Ø¸Ø§Ù… message Ø£Ø®Ø¶Ø±
  socket.on("broadcast-ping", ({ name, ping }) => {
    io.emit("system message", {
      msg: `ðŸ“¶ Ø¨Ù€Ù€Ù†Ù€Ù€Ù‚   ${name}: ${ping}ms`,
      color: "limegreen"
    });
  });

  io.emit("state", {
    word: currentWord,
    scores: usersScores(),
  });

  socket.on("chat message", (msg) => {
    if (socket.data.observer) return;
    if (mutedPlayers.has(socket.data.name) && !socket.data.isAdmin) return;
    io.emit("chat message", { name: socket.data.name, msg });
  });

  socket.on("set name", (name) => {
    if (socket.data.observer) return;
    if (isNameTaken(name)) {
      socket.emit("name-taken", name);
      return;
    }
    socket.data.name = name;
    socket.emit("set name", name);
    io.emit("state", { word: currentWord, scores: usersScores() });
  });

  socket.on("answer", (ans) => {
    if (socket.data.observer) return;
    if (!roundActive) return;
    const trimmed = ans.trim().replace(/\s/g, "");
    const correctWordNoSpace = currentWord.replace(/\s/g, "");
    if (trimmed === correctWordNoSpace || ans.trim() === currentWord || trimmed === "-") {
      roundActive = false;
      socket.data.points++;
      io.emit("round result", {
        winner: socket.data.name,
        word: currentWord,
        scores: usersScores(),
      });
      setTimeout(nextRound, 3000);
    }
  });

  socket.on("kick player", ({ kicked }) => {
    if (socket.data.observer) return;
    if (!socket.data.isAdmin) return;
    if (!kicked || kicked === socket.data.name) return;
    const targetSocket = findSocketByName(kicked);
    if (!targetSocket) return;
    io.emit("kick message", { kicker: socket.data.name, kicked });
  });

  socket.on("mute player", ({ muted }) => {
    if (!socket.data.isAdmin) return;
    if (!muted) return;
    mutedPlayers.add(muted);
  });

  socket.on("unmute player", ({ unmuted }) => {
    if (!socket.data.isAdmin) return;
    if (!unmuted) return;
    mutedPlayers.delete(unmuted);
  });

  socket.on("disconnect", () => {
    if (!socket.data.observer) {
      io.emit("system message", {
        msg: `${socket.data.name} Ø®Ø±Ø¬ Ù…Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©`,
        color: "blue"
      });
    }
    io.emit("state", {
      word: currentWord,
      scores: usersScores(),
    });
  });
});

const mutedPlayers = new Set();

function usersScores() {
  const arr = [];
  for (let [id, socket] of io.of("/").sockets) {
    if (!socket.data.observer) {
      arr.push({ name: socket.data.name, points: socket.data.points });
    }
  }
  return arr;
}

function nextRound() {
  currentWord = words[Math.floor(Math.random() * words.length)];
  roundActive = true;
  io.emit("new round", { word: currentWord, scores: usersScores() });
}

function isNameTaken(name) {
  for (let [id, socket] of io.of("/").sockets) {
    if (!socket.data.observer && socket.data.name === name) return true;
  }
  return false;
}

function findSocketByName(name) {
  for (let [id, socket] of io.of("/").sockets) {
    if (!socket.data.observer && socket.data.name === name) return socket;
  }
  return null;
}

function generateUniqueName() {
  let name;
  do {
    name = `User${Math.floor(Math.random() * 10000)}`;
  } while (isNameTaken(name));
  return name;
}

http.listen(process.env.PORT || 3000, () => {
  console.log("Started");
  nextRound();
});
