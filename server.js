const express = require("express");
const app = express();
const http = require("http").Server(app);
const io = require("socket.io")(http);

const words = [
  "مكياج",
  "اسنان",
  "زيتون",
  "ثور",
  "كاميرا",
  "شوكولاته",
  "بطارية",
  "طاولة",
  "زومبي",
  "انف",
  "شنب",
  "ممرضة",
  "بيت",
  "ذهب",
  "بروكلي",
  "ديناصور",
  "اسد",
  "طائرة",
  "ضفدع",
  "فاصوليا",
  "تاج",
  "سنجاب",
  "دجاج",
  "طريق",
  "كوالا",
  "فراشة",
  "يضحك",
  "تبولة",
  "سحلية",
  "شامبو",
  "محفظة",
  "نجوم",
  "باص",
  "صيدلي",
  "مخدة",
  "شارع",
  "زيت",
  "جاكيت",
  "اخطبوط",
  "ابرة",
  "قارورة",
  "فهد",
  "ذئب",
  "حلاوة",
  "مصاصة",
  "كتاب",
  "زهرة",
  "بطريق",
  "معدة",
  "رقص",
  "كرة قدم",
  "خفاش",
  "دفتر",
  "فطيرة",
  "مسرح",
  "غيوم",
  "قمر",
  "صحن",
  "ورق عنب",
  "وردة",
  "كأس",
  "فرس النهر",
  "نسر",
  "ثوب",
  "عسل",
  "جمل",
  "مسمار",
  "مدينة",
  "دباب",
  "مسطرة",
  "طاووس",
  "خس",
  "كوخ",
  "مايك",
  "طباخ",
  "افوكادو",
  "درع",
  "قنبلة",
  "توت",
  "رمح",
  "مرآة",
  "ملك",
  "حمام",
  "فستان",
  "جبن",
  "محاسب",
  "مدرسة",
  "عامل نظافة",
  "مكنسة",
  "كيس",
  "توصيلة",
  "شراب",
  "مكعب",
  "بطة",
  "جدار",
  "شماغ",
  "كريب",
  "لابتوب",
  "ملوخية",
  "كرز",
  "عشب",
  "بطيخ",
  "تلفاز",
  "طيار",
  "شاحن",
  "رسام",
  "قهوة",
  "جزيرة",
  "صابون",
  "ساعة يد",
  "كرسي",
  "جبل",
  "عصفور",
  "ثعبان",
  "ملفوف",
  "كرة سلة",
  "برياني",
  "قلعة",
  "كبة",
  "كوكب",
  "حزين",
  "سبانخ",
  "سوشي",
  "هاتف",
  "ساعة",
  "ورقة",
  "عين",
  "بومة",
  "لاما",
  "ماء",
  "خريطة",
  "نظارة",
  "علبة",
  "شبح",
  "كنافة",
  "سمبوسة",
  "سمكة",
  "دمية",
  "قفل",
  "اعصار",
  "يبكي",
  "بطاطس",
  "صلعه",
  "اذن",
  "نافذة",
  "ممثل",
  "فيل",
  "ريموت",
  "شاطئ",
  "فيش",
  "حبل",
  "حامل",
  "سماء",
  "سجادة",
  "سلم",
  "كيوي",
  "مندي",
  "ذرة",
  "نعامة",
  "عصا",
  "خبز",
  "صائغ",
  "كب كيك",
  "طفل",
  "قاضي",
  "سيارة",
  "بيتزا",
  "بيض",
  "مقلوبة",
  "عائلة",
  "كفتة",
  "يد",
  "بائع",
  "ديك",
  "ظفر",
  "شريط",
  "شاي",
  "حصان",
  "ستارة",
  "عود",
  "مروحة",
  "سكين",
  "نجار",
  "سلسلة",
  "مجرة",
  "كوكيز",
  "فم",
  "دب قطبي",
  "وحيد القرن",
  "حليب",
  "سماعة",
  "رز",
  "شتاء",
  "مرحاض",
  "سلة",
  "سلطة",
  "هرم",
  "لسان",
  "يمشي",
  "قنديل",
  "خلاط",
  "مكرونة",
  "فرشاة",
  "سلك",
  "عطر",
  "كرة",
  "برج ايفل",
  "قرد",
  "قلم رصاص",
  "هيكل عظمي",
  "فطر",
  "غراب",
  "فلاشة",
  "حفرة",
  "مانجو",
  "ساعة رملية",
  "قبعة",
  "اطفائي",
  "الماس",
  "ثعلب",
  "خروف",
  "ستيك",
  "مطرقة",
  "ارنب",
  "كبسة",
  "سجاده",
  "فانوس",
  "كيبورد",
  "كنز",
  "يركض",
  "موية",
  "ملح",
  "قلب",
  "جرس",
  "خياط",
  "بيانو",
  "شمعة",
  "سلطعون",
  "مسدس",
  "اصبع",
  "حمار",
  "كشري",
  "زبالة",
  "باذنجان",
  "رمان",
  "جوز الهند",
  "شاحنة",
  "لحم",
  "مذيع",
  "كهربائي",
  "كباب",
  "كمبيوتر",
  "رموش",
  "سروال",
  "مستشفى",
  "وسادة",
  "صرصور",
  "علم",
  "صاروخ",
  "فول",
  "عظم",
  "الارض",
  "سجق",
  "باب",
  "كنبة",
  "حديقة",
  "بصل",
  "فأر",
  "مظلة",
  "قوس قزح",
  "خيمة",
  "دجاج مشوي",
  "مغني",
  "جوافة",
  "حلزون",
  "قدم",
  "نهر",
  "فشار",
  "مزرعة",
  "حوت",
  "سيف",
  "طابعة",
  "غزال",
  "هدية",
  "مهندس",
  "بطاطا",
  "زرافة",
  "دونات",
  "الكعبة",
  "فرن",
  "جامعة",
  "مكيف",
  "ماعز",
  "ريشة",
  "مكتب",
  "منشار",
  "ماوس",
  "دكتور",
  "سبورة",
  "مكتبة",
  "فأس",
  "جوال",
  "قطايف",
  "خوخ",
  "بسكوت",
  "حجر",
  "خشب",
  "معلم",
  "مطبخ",
  "جالس",
  "بطن",
  "قوس",
  "ايس كريم",
  "قرش",
  "طاوله",
  "غرفة",
  "حاجب",
  "فلافل",
  "عنب",
  "جوارب",
  "برج خليفة",
  "موز",
  "دولاب",
  "روبوت",
  "سرير",
  "مسبح",
  "نعال",
  "شاشة",
  "وحش",
  "فقمة",
  "ملعب",
  "سينما",
  "حمص",
  "جاموس",
  "ولاعة",
  "صقر",
  "جزر",
  "قدر",
  "سفينة",
  "هدهد",
  "تنين",
  "نقانق",
  "نار",
  "مشط",
  "عصير",
  "قميص",
  "فلوس",
  "ليل",
  "بامية",
  "شوربة",
  "فرشة",
  "خيار",
  "عنكبوت",
  "طبل",
  "نخلة",
  "دودة",
  "برق",
  "ثلج",
  "حلاق",
  "برجر",
  "مزهرية",
  "ببغاء",
  "باندا",
  "يسبح",
  "ملعقة",
  "مطعم",
  "زر",
  "كنغر",
  "تفاح",
  "بقلاوة",
  "كوب",
  "ليمون",
  "ثلاجة",
  "فراولة",
  "غوريلا",
  "تمر",
  "حذاء",
  "تمساح",
  "نمر",
  "كاتشب",
  "منسف",
  "صندوق",
  "برتقال",
  "مكة",
  "شرطي",
  "شجرة",
  "عدس",
  "جمجمة",
  "غسالة",
  "فلفل",
  "اشارة مرور",
  "غابة",
  "ميكانيكي",
  "روبيان",
  "سائق",
  "عقرب",
  "قلم",
  "محامي",
  "اناناس",
  "شوكة",
  "بحر",
  "طماطم",
  "كيك",
  "قنفذ",
  "دم",
  "قارب",
  "صبار",
  "بقرة",
  "شطرنج",
  "لاعب",
  "شلال",
  "خنزير",
  "برج",
  "حمار وحشي",
  "دبابة",
  "عمارة",
  "دباسة",
  "مشمش",
  "نوم",
  "نمل",
  "مصور",
  "صحراء",
  "ذبابة",
  "ثوم",
  "شمام",
  "نحلة",
  "منديل",
  "قطة",
  "مسجد",
  "مفتاح",
  "راكون",
  "دراجة",
  "كنب",
  "مطر",
  "قطار",
  "بطه",
  "سلحفاة",
  "بلياردو",
  "مقص",
  "حقيبة",
  "شنطة",
  "فراخ",
  "ضبع",
  "كلب",
  "شاورما",
  "خاتم",
  "مصباح",
  "دولفين",
  "افعى",
  "سكر",
  "بركان",
  "غواصة",
  "دب",
  "ابرة",
  "اخطبوط",
  "اذن",
  "الارض",
  "ارنب",
  "اسد",
  "اسنان",
  "اشارة مرور",
  "اصبع",
  "اطفائي",
  "اعصار",
  "افعى",
  "افوكادو",
  "اناناس",
  "انف",
  "ايس كريم",
  "باب",
  "باذنجان",
  "باص",
  "بامية",
  "باندا",
  "بائع",
  "ببغاء",
  "بحر",
  "برتقال",
  "برج",
  "برج ايفل",
  "برج خليفة",
  "برجر",
  "برق",
  "بركان",
  "بروكلي",
  "برياني",
  "بسكوت",
  "بسكويت",
  "بصل",
  "بطارية",
  "بطاطا",
  "بطاطس",
  "بطة",
  "بطريق",
  "بطن",
  "بطه",
  "بطيخ",
  "بقرة",
  "بقلاوة",
  "بلياردو",
  "بومة",
  "بيانو",
  "بيت",
  "بيتزا",
  "بيض",
  "تاج",
  "تبولة",
  "تفاح",
  "تلفاز",
  "تمر",
  "تمساح",
  "تنين",
  "توت",
  "توصيلة",
  "ثعبان",
  "ثعلب",
  "ثلاجة",
  "ثلج",
  "ثوب",
  "ثور",
  "ثوم",
  "جاكيت",
  "جالس",
  "جامعة",
  "جاموس",
  "جبل",
  "جبن",
  "جدار",
  "جرس",
  "جزر",
  "جزيرة",
  "جمجة",
  "جمل",
  "جوارب",
  "جوافة",
  "جوال",
  "جوز الهند",
  "جوهرة",
  "حاجب",
  "حامل",
  "حبل",
  "حجر",
  "حديقة",
  "حذاء",
  "حزين",
  "حصان",
  "حفرة",
  "حقيبة",
  "حلاق",
  "حلاوة",
  "حلزون",
  "حليب",
  "حمار",
  "حمار وحشي",
  "حمام",
  "حمص",
  "حوت",
  "خاتم",
  "خبز",
  "خروف",
  "خريطة",
  "خس",
  "خشب",
  "خفاش",
  "خلاط",
  "خنزير",
  "خوخ",
  "خيار",
  "خياط",
  "خيمة",
  "دب",
  "دب قطبي",
  "دباب",
  "دباسة",
  "دجاج",
  "دجاج مشوي",
  "دراجة",
  "درع",
  "دفتر",
  "دكتور",
  "دم",
  "دمية",
  "دودة",
  "دولاب",
  "دولفين",
  "دونات",
  "ديك",
  "ديناصور",
  "ذبابة",
  "ذرة",
  "ذهب",
  "ذئب",
  "راكون",
  "رز",
  "رسام",
  "رقص",
  "رمان",
  "رمح",
  "رموش",
  "روبوت",
  "روبيان",
  "ريشة",
  "ريموت",
  "زبالة",
  "زر",
  "زرافة",
  "زهرة",
  "زومبي",
  "زيت",
  "زيتون",
  "ساعة",
  "ساعة رملية",
  "ساعة يد",
  "سائق",
  "سبانخ",
  "سبورة",
  "ستارة",
  "ستيك",
  "سجادة",
  "سجاده",
  "سجق",
  "سحلية",
  "سروال",
  "سرير",
  "سفينة",
  "سكر",
  "سكين",
  "سلة",
  "سلحفاة",
  "سلسلة",
  "سلطة",
  "سلطعون",
  "سلك",
  "سلم",
  "سماء",
  "سماعة",
  "سمبوسة",
  "سمكة",
  "سنجاب",
  "سوشي",
  "سيارة",
  "سيف",
  "سينما",
  "شاحن",
  "شاحنة",
  "شارع",
  "شاشة",
  "شاطئ",
  "شامبو",
  "شاورما",
  "شاي",
  "شبح",
  "شتاء",
  "شجرة",
  "شراب",
  "شرطي",
  "شريط",
  "شطرنج",
  "شلال",
  "شماغ",
  "شمام",
  "شمبانزي",
  "شمعة",
  "شنب",
  "شنطة",
  "شوربة",
  "شوكة",
  "شوكولاته",
  "صابون",
  "صاروخ",
  "صائغ",
  "صبار",
  "صحراء",
  "صحن",
  "صرصور",
  "صقر",
  "صلعه",
  "صندوق",
  "صوص",
  "صيدلي",
  "ضبع",
  "ضفدع",
  "طابعة",
  "طاولة",
  "طاوله",
  "طاووس",
  "طائر",
  "طائرة",
  "طباخ",
  "طبل",
  "طريق",
  "طفل",
  "طماطم",
  "طيار",
  "ظفر",
  "عامل",
  "عامل نظافة",
  "عائلة",
  "عدس",
  "عسل",
  "عشب",
  "عصا",
  "عصير",
  "عطر",
  "عظم",
  "عقرب",
  "علبة",
  "علم",
  "عمارة",
  "عنب",
  "عنكبوت",
  "عود",
  "عين",
  "غابة",
  "غراب",
  "غرفة",
  "غزال",
  "غسالة",
  "غواصة",
  "غوريلا",
  "غيوم",
  "فأر",
  "فأس",
  "فاصوليا",
  "فانوس",
  "فراشة",
  "فراولة",
  "فرس النهر",
  "فرشاة",
  "فرشة",
  "فرن",
  "فستان",
  "فشار",
  "فطر",
  "فطيرة",
  "فقمة",
  "فلاشة",
  "فلافل",
  "فلفل",
  "فلوس",
  "فم",
  "فهد",
  "فول",
  "فيش",
  "فيل",
  "قارب",
  "قارورة",
  "قاضي",
  "قبعة",
  "قدر",
  "قدم",
  "قرد",
  "قرش",
  "قزح",
  "قطار",
  "قطايف",
  "قطة",
  "قفل",
  "قلب",
  "قلعة",
  "قلم",
  "قلم رصاص",
  "قمر",
  "قميص",
  "قنبلة",
  "قنديل",
  "قنفذ",
  "قهوة",
  "قوس",
  "كاتشب",
  "كأس",
  "كاميرا",
  "كب كيك",
  "كباب",
  "كبة",
  "كبسة",
  "كتاب",
  "كرة",
  "كرة سلة",
  "كرز",
  "كرسي",
  "كريب",
  "كشري",
  "الكعبة",
  "كفتة",
  "كلب",
  "كمبيوتر",
  "كنافة",
  "كنب",
  "كنبة",
  "كنز",
  "كنغر",
  "كهربائي",
  "كوالا",
  "كوب",
  "كوخ",
  "كوكب",
  "كوكيز",
  "كيبورد",
  "كيس",
  "كيك",
  "كيوي",
  "لابتوب",
  "لاعب",
  "لاما",
  "لحم",
  "لسان",
  "ليل",
  "ليمون",
  "ماء",
  "الماس",
  "ماعز",
  "مانجو",
  "ماوس",
  "مايك",
  "مجرة",
  "محاسب",
  "محامي",
  "محفظة",
  "مخدة",
  "مدرسة",
  "مدينة",
  "مذيع",
  "مرآة",
  "مرحاض",
  "مروحة",
  "مزرعة",
  "مزهرية",
  "مسبح",
  "مسجد",
  "مسدس",
  "مسرح",
  "مسطرة",
  "مسمار",
  "مشط",
  "مصاصة",
  "مصباح",
  "مصور",
  "مطبخ",
  "مطر",
  "مطرقة",
  "مطعم",
  "مظلة",
  "معدة",
  "معلم",
  "مغني",
  "مفتاح",
  "مقص",
  "مقلوبة",
  "مكة",
  "مكتب",
  "مكتبة",
  "مكرونة",
  "مكعب",
  "مكنسة",
  "مكياج",
  "مكيف",
  "ملح",
  "ملعب",
  "ملعقة",
  "ملفوف",
  "ملك",
  "ملوخية",
  "ممثل",
  "ممرضة",
  "مندي",
  "منديل",
  "منسف",
  "منشار",
  "مهندس",
  "موز",
  "موية",
  "ميكانيكي",
  "نار",
  "نافذة",
  "نجار",
  "نجمة",
  "نجوم",
  "نحلة",
  "نخلة",
  "نسر",
  "نظارة",
  "نظافة",
  "نعال",
  "نعامة",
  "نقانق",
  "نمر",
  "نمل",
  "نهر",
  "نوم",
  "نيزك",
  "هدهد",
  "هدية",
  "هرم",
  "هيكل عظمي",
  "وحش",
  "وحيد القرن",
  "وردة",
  "ورق عنب",
  "وسادة",
  "ولاعة",
  "يبكي",
  "يد",
  "يركض",
  "يسبح",
  "يضحك",
  "يمشي",
];
let currentWord = "";
let roundActive = false;

app.use(express.static("public"));

io.on("connection", (socket) => {
  socket.data.points = 0;

  const defaultName = `لاعب${Math.floor(Math.random() * 10000)}`;
  socket.data.name = defaultName;
  socket.emit("set name", defaultName);

  io.emit("state", {
    word: currentWord,
    scores: usersScores(),
  });

  socket.on("chat message", (msg) => {
    io.emit("chat message", { name: socket.data.name, msg });
  });

  socket.on("set name", (name) => {
    socket.data.name = name;
    io.emit("state", { word: currentWord, scores: usersScores() });
  });

  socket.on("answer", (ans) => {
    if (!roundActive) return;
    if (ans.trim() === currentWord) {
      roundActive = false;
      socket.data.points++;
      io.emit("round result", {
        winner: socket.data.name,
        word: currentWord,
        scores: usersScores(),
      });
      setTimeout(nextRound, 3000);
    }
  });
});

function usersScores() {
  const arr = [];
  for (let [id, socket] of io.of("/").sockets) {
    arr.push({ name: socket.data.name, points: socket.data.points });
  }
  return arr;
}

function nextRound() {
  currentWord = words[Math.floor(Math.random() * words.length)];
  roundActive = true;
  io.emit("new round", { word: currentWord, scores: usersScores() });
}

http.listen(process.env.PORT || 3000, () => {
  console.log("Started");
  nextRound();
});
